##########################################################################################
#                                                                                        #
# WARNING: THIS FILE CONTAINS DEFAULT SETTINGS FOR PRIVX. PLEASE DO NOT EDIT THIS FILE.  #
#                                                                                        #
##########################################################################################

[GLOBAL]
[GLOBAL.audit]
# Folder for audit trail data.
data_folder = "/var/privx/audit/"

# How many days a trail is available.
# -1 means trails are not removed.
trail_expiry = 180

# How many days a transferred file for a trail is available.
# -1 means transferred files are not removed.
transferred_files_expiry = 180

# Enable trail file and directory timestamp obfuscation.
file_timestamp_obfuscation = true

# Timeout for connections when no connection manager, in minutes.
# 0 means no timeout, connections are kept open.
timeout_when_no_connmgr = 5

[GLOBAL.ldapconnections]
# Should we use system cert pool with TLS
# i.e. enable_ldap_system_roots_cert_pool = true
enable_ldap_system_roots_cert_pool = true

# LDAP query connection timeout in seconds
# i.e. connection_timeout = 10
ldap_connection_timeout = 10

# LDAP how times to retry if connection times out
ldap_retry_attempts = 3

# Should we use custom root certificates
# i.e. enable_ldap_custom_root_certificates = false
enable_ldap_custom_root_certificates = false

# Custom root certificate in PEM format, which will be added to cert pool for LDAP connections.
# Not used if enable_ldap_custom_root_certificates is false
# i.e. ldap_root_ca_pem = '''
# <insert PEM cert here>
# '''
ldap_root_ca_pem = '''
'''

# Disclaimer configuration, shown the login page
[GLOBAL.disclaimer]
# Example:
# [
#   {
#     "id": "terms-and-conditions",
#     "timeStamp": "2020-01-01T12:00:00Z",
#     "title": "Terms and Conditions",
#     "text": "Lorem ipsum dolor sit amet.",
#     "accept": "I have read and agree to the terms and conditions",
#     "mode": "popup",
#     "acceptable": true,
#     "closeable": false
#   }
# ]
privx_disclaimer = '''[]'''

# Application switcher
[GLOBAL.application_switcher]
# A link to SSH UKM product, wisible on integration links
privx_app_switcher_links_ukm = ""

[GLOBAL.rdp_common]
# Trust anchor certificates for RDP host certificate validation. If host certificate
# is valid and signed by one of the trust anchors then the host certificate is
# silently accepted. Trust anchor certificates are configured as one or multiple
# concatenated PEM certificates. RDP host certificate validation does not support
# multi level CA hierarchies. Thus the trust anchor certificates need to be direct
# issuing certificates of the host certificates.
host_certificate_trust_anchors = ""

# If enabled, the allow_plaintext_vnc will not setup an ssh tunnel to secure the
# vnc connection. By default, the option is disabled and vnc connections secured
allow_plaintext_vnc = false

[GLOBAL.ssh_common]

# when set to true, the audit_enabled is used to audit SSH events that are
# listed in the section events_to_audit below.
audit_enabled = false

# events_to_audit is used to list the type of SSH events that should be audited.
# The list of event types is provided as an array and the following are
# valid event types:
# - stdin
# - stdout
# - stderr
# - channel_request
# - global_request
events_to_audit = [
"stdout",
"stderr",
"channel_request",
"global_request"
]

[GLOBAL.icap]
# Enable ICAP for RDP web UI file transfers
icap_for_rdp_proxy = false

# Enable ICAP for RDP native client file transfers
icap_for_rdp_mitm = false

# Enable ICAP for SSH web UI file transfers (not implemented yet)
icap_for_ssh_proxy = false

# Enable ICAP for SSH native client file transfers (not implemented yet)
icap_for_ssh_mitm = false

# ICAP server hostname
# Example: 10.1.1.1
icap_server_hostname = ""

# ICAP server port
# Example: 1344
icap_server_port = 1344

# Send a response modification with http request headers, using this url
# Example: icap://10.1.1.1:1344/respmod
icap_respmod_url = ""

# Send a request modification instead of response modification, using this url
# Example: icap://10.1.1.1:1344/reqmod
icap_reqmod_url = ""

# Set maximum preview data size. Set to 0 to disable preview
icap_preview_length = 4096

# Optional service name for ICAP server
# Example: "squidclamav"
icap_service_name = ""

# ICAP client binary path
icap_client_binary_path = "/opt/privx/bin/c-icap-client"

[GLOBAL.live_monitoring]
# Disable live monitoring for services
enable_live_ssh = true
enable_live_rdp = true
enable_live_vnc = true
enable_live_web = true

[GLOBAL.invalidated_session_cache]
# Change size of invalidated session cache
cache_size = 1000000

[GLOBAL.watermarking]
# Example:
# host_heading: [
#   {
#     "selectors": ["tags=*production*", "address=*.amazonaws.com"],
#     "heading": {
#       "text": "Zone1 - %U@%H",
#       "color": "#ff4c13"
#     }
#   },
#   {
#     "selectors": ["address=172.16.0.0/24", "account=admin"],
#     "heading": {
#       "text": "Zone 2 - %u - %T",
#       "style": "orange"
#     }
#   }
# ]
#
# host_watermark: [
#   {
#     "selectors": ["common_name=*production*", "address=*.amazonaws.com"],
#     "watermark": {
#       "text": "Zone2 - %U@%H"
#     }
#   }
# ]
host_heading = '''[]'''
host_watermark = '''[]'''

[GLOBAL.mobile_gw]
use_static_ips = false


##########################################################################################

[ROLE-STORE]
[ROLE-STORE.scanning]
# Host scanning delay after starting the service in seconds.
# i.e. first_host_scanning_delay = 30
first_host_scanning_delay = 30

# Host scanning frequency default value in seconds.
# How often cloud hosts are being scanned.
# i.e. host_scanning_frequency = 300
host_scanning_frequency = 300

# AWS role scanning delay after starting the service
first_role_scanning_delay = 10

# Frequency for resolving explicit member counts for roles
role_member_count_update_frequency = 15

# LDAP settings
[ROLE-STORE.ldap]
# Default LDAP cache TTL (in seconds). Used if no TTL is given for LDAP data source on application UI.
# After the cache expires, it will not be purged until the fresh content is retrieved from LDAP, so the cache expiration
# might take a few seconds longer than the actual TTL (depending on your server setup and amount of users)
# i.e. default_cache_ttl = 900
default_cache_ttl = 900

# Default pre-filter to use when searching users. Not required, but allows using shorter LDAP search strings in application UI.
# Use this to filter out non-user objects. Source connection ldap_user_filter setting will override this default setting.
# Leaving all user filters empty would increase cache memory usage, as the service would then cache all LDAP objects.
# i.e. default_user_filter = "(&(objectClass=user)(objectClass=person))"
default_user_filter = "(|(objectClass=user)(objectClass=person)(objectClass=inetOrgPerson))"

# LDAP attributes filter
# Tells which attributes to fetch from LDAP for caching. Leaving this empty will fetch all attributes for LDAP objects.
# Filtering out unused attributes will make the memory consumption smaller and improve query times.
# i.e. attributes = "objectClass cn dn distinguishedName whenCreated whenChanged name userPrincipalName givenName company departmentNumber mail email mobile sAMAccountName uid memberOf entryDN displayName userAccountControl groupType servicePrincipalName objectCategory objectGUID objectSID sn"
attributes = "objectClass cn dn distinguishedName whenCreated whenChanged name userPrincipalName givenName company departmentNumber mail email mobile sAMAccountName uid memberOf entryDN displayName userAccountControl groupType servicePrincipalName objectCategory objectGUID objectSID sn"

# Automatically append this filter to AD requests when fetching users or mapping roles
# Can be used to filter out disabled users and such.
# Default: filter out disabled users
# global_ad_user_filter = "(!userAccountControl:1.2.840.113556.1.4.803:=2)"
global_ad_user_filter = "(!userAccountControl:1.2.840.113556.1.4.803:=2)"

# LDAP query paging size
# The default maximum for Active Directory is 1000
# Use as big value as possible for maximum performance.
# i.e. paging_size = 1000
paging_size = 1000

# Enable nested groups for role mappings. Enables LDAP_MATCHING_RULE_IN_CHAIN (1.2.840.113556.1.4.1941) filter for role queries
# against user directories.
# i.e. (memberOf:1.2.840.113556.1.4.1941:=CN=masterGroup,CN=Users,DC=testad,DC=example,DC=com)
# This option affects only to role mappings, AD directory settings are not affected by this setting.
# Default: enable_nested_groups = false
enable_nested_groups = false

# Authorized keys settings
[ROLE-STORE.authorizedkeys]
# Authorized key maximum validity period length in days
# Valid values are 1 - 7300 days.
max_validity_days = 730

# Supported public key types:
#  ssh-rsa
#  ssh-ed25519
#  ssh-dss
#  ecdsa-sha2-nistp224
#  ecdsa-sha2-nistp256
#  ecdsa-sha2-nistp384
#  ecdsa-sha2-nistp521
supported_key_types = [
"ssh-rsa",
"ssh-ed25519"
]

# Minimum key size in bits for ssh-rsa keys
min_rsa_key_size = 2048

# Expired authorized keys purge interval in hours
# Set to 0 to disable automatic deletion of expired
# authorized keys.
expired_purge_interval_hours = 24

# Host directory settings
[ROLE-STORE.directory]
# Blacklisted host tag prefixes
# When "Import host instance tags from the directory" is enabled for cloud directory config, all host tags
# will be imported to PrivX except tags starting with these prefixes.
# i.e. blacklisted_host_tag_prefixes = [
#   "privx-",
#   "aws:",
#   "ssh-keys",
#   "windows-keys",
# ]
blacklisted_host_tag_prefixes = [
"privx-",
"aws:",
"ssh-keys",
"windows-keys",
]

[ROLE-STORE.housekeeping]
# Unused SCIM role housekeeping interval in minutes
scim_role_housekeeping_interval = 720
users_active_interval = 15780000

# Amazon Web Services settings
[ROLE-STORE.aws]
#
# Defines if AWS support is enabled
# i.e. enabled=true
enabled=true

# AWS default region
# Default region to use for fetching access tokens
# i.e. default_region=us-east-1
default_region="us-east-1"

# Enable assume-role temporary credentials.
# These credentials can be used to give SSH PrivX users temporary access to different AWS services via AWS roles.
# assume-role supports MFA devices.
# i.e. enable_assume_role=true
enable_assume_role=true

# Default expiration time (seconds) for assume-role temporary credentials if TTL is not given:
# AWS service limit is 900 (15 min), lower values will be ignored.
# i.e. assume_role_default_ttl=900
assume_role_default_ttl=900

# Enable federation token access
# These credentials can be used to give SSH PrivX users temporary access to different AWS services via AWS roles.
# Federation tokens do not support MFA devices like assume-role tokens, but allow longer validity periods
# for temporary credentials.
enable_federated_tokens=true

# Default expiration time (seconds) for federation token temporary credentials if TTL is not given:
# AWS service limit is 900 (15 min), lower values will be ignored.
# i.e. federated_tokens_default_ttl=900
federated_tokens_default_ttl=900

# Maximum number of AWS roles to fetch for role federation (after filtering)
max_aws_roles = 1000

# Session cache settings
[ROLE-STORE.caching]
# Per session User<->role mapping cache
# Caches the user roles and people belonging to a specific role.
# The cache uses the OAuth token as part of the key, so logging out will invalidate the cache.
# i.e. enable = true
enable = true

# Cache TTL in seconds. Should be set to a relatively small value.
# Setting this to too small value (i.e. ~Â 1-2 seconds) might cause synchronization issues when running multiple instances
# of the same services.
# i.e. ttl = 60
ttl = 60

# Enable rule evaluation cache.
# If enabled, caches source rule evaluation results.
# If there is lots of source rules, enabling this will improve the performance.
# Note that enabling this also means the changing the user data will not immediately affect to user roles if the user
# has used the service within caching.ttl seconds. If user is not logged in yet or is idle, the change is immediate.
# If you want your rules to be always effective immediately, disable this setting.
# i.e. rule_evaluation_cache_enabled = true
rule_evaluation_cache_enabled = true

# Cache TTL for user caching in seconds. Separate from session cache, if user in user cache has been refreshed last time
# in less than TTL seconds, it won't be reloaded from directory (AD/LDAP)
# i.e. user_cache_refresh_ttl = 60
user_cache_refresh_ttl = 60

# Cache type
# Possible values: "local" (in-mem LRU cache), "redis"
# i.e. type = "local"
type = "local"

# (Local cache only) LRU cache size. If cache gets full, the least recently used values are purged.
# i.e. max_entries = 100000
max_entries = 100000

# Internal in-mem cache periodic synchronization interval in seconds
# Set to 0 to disable periodic in-mem cache synchronization.
sync_interval_seconds = 60

# Size of the cache that stores deleted roles in memory.
# min = 1000, max = 10000000, default = 1000000
deleted_roles_cache_size = 1000000

[ROLE-STORE.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 20

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[ROLE-STORE.scim]
# maximum result count for SCIM GET
max_results = 100

[ROLE-STORE.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

[ROLE-STORE.principal_keys]
add_on_role_creation = false

##########################################################################################

[HOST-STORE]
[HOST-STORE.initial-host-service-options-ssh]
shell = true
file_transfer = true
exec = true
tunnels = true
x11 = true
other = true

[HOST-STORE.initial-host-service-options-rdp]
file_transfer = true
audio = true
clipboard = true

[HOST-STORE.initial-host-service-options-web]
file_transfer = true
audio = true
clipboard = true

[HOST-STORE.initial-host-service-options-vnc]
file_transfer = true
clipboard = true

# Health checks for services configured for hosts
[HOST-STORE.health-check-options]
# Should PrivX perform network connectivity health checks for services
service_health_checks_enabled = true

# Max concurrent service health requests
# Default: 3
service_health_check_max_workers = 3

# Max service health check requests per second per worker
# Default: 1
service_health_check_max_requests_per_second = 1

# Delay between health check runs in seconds
# Default 600 seconds
service_health_check_wait = 600

# Housekeeping settings
[HOST-STORE.host-house-keeping]
# Interval for housekeeping, in Hours. Specifies the frequency
# in which the clean-up josb (housekeeping) runs. The job, deletes the
# marked as "deleted" hosts from the hosts table that have been marked as deleted
# for a period mentioned in the "hosts_deleted_age" config value.
# -1 means housekeeping is disabled. Default value "168" hours - run once per week (7 days)
host_housekeeping_run_interval = 168

# Age of marked deleted hosts, in Hours.
# Valid value >= 1, default value taken in code is 168 Hours - A week old
# marked deleted hosts are removed from the DB.
hosts_deleted_age = 168

[HOST-STORE.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 20

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[HOST-STORE.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[MONITOR-SERVICE]
[MONITOR-SERVICE.housekeeping]
# Interval for status check, in seconds.
# 0 disables the check.
status_check_interval = 10

# Interval for housekeeping, in hours.
# 0 disables the housekeeping
housekeeping_interval = 8

# DB data retention period, in days
# Number of days the audit events must be kept in database
# -1 disables the audit events deletion
data_retention_period = 180

# Interval for system health check, in Hours.
# 0 disables the check.
system_health_check_interval = 1

# Interval for removing expired keys from the db cache table, in Seconds
cache_db_expiry_interval = 300

# Warning threshold for running low on disk space for external components,
# in GB
external_component_low_storage_warning_threshold = 5

# Max age of inactive components status, in hours.
# -1 disables the component status deletion
status_expunction_delay = 24

# Interval for database certificate check, in hours.
# 0 disables the check.
db_certificate_check_interval = 1

[MONITOR-SERVICE.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 20

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[MONITOR-SERVICE.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[TRAIL-INDEX]
[TRAIL-INDEX.workers]
no_of_workers = 10

[TRAIL-INDEX.housekeeping]
# Interval for housekeeping, in minutes.
# -1 means housekeeping is disabled.
housekeeping_interval = 30

[TRAIL-INDEX.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[TRAIL-INDEX.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[RDP-PROXY]
[RDP-PROXY.rdp_proxy]
# RDP shared directory
share_dir = "/tmp/rdp-drive/"

# RDP smart card authentication
smartcard_authentication_enabled = true

# Reauthorization interval in seconds
reauthorization_interval_sec = 300

# RDP extender toggle
# Enable to allow remote PrivX Extender client connections for tunneling RDP traffic inside VPC networks.
extender_enabled = true

# Web socket keepalive interval in seconds
ws_keepalive_interval_sec = 30

# Allow target connections to loopback addresses
allow_connect_to_loopback = false

# Allow target connections to local interface addresses
allow_connect_to_local_addresses = false

# Target blacklist: a comma separated list of IP addresses or subnets (CIDR) of prohibited RDP targets
target_blacklist = ""

# RDP Web Proxy toggle
# Enable to allow remote web proxy (Squid) to authorize web connections via PrivX Web Proxy server.
web_proxy_enabled = true

# When connecting directly, check that target is reachable.
connectivity_test_timeout = 30

# Disable windows smart card login failure workaround.
smartcard_status_workaround_disabled = true

# Timeout interval (seconds) for connection message reply.
# Default: 5 seconds.
connection_message_timeout_sec = 5

# Enable wallpaper on target hosts. Disabled by default for performance reasons.
enable_wallpaper = false

# Enable font smoothing on target hosts.
enable_font_smoothing = true

[RDP-PROXY.certificates]
# Replace the stored certificate if received target certificate is differ from stored certificate.
update_automatically = true

# Acceptable renewal period in months for received target certificate if it is differ from stored certificate
renewal_period_months = 1

# Acceptable renewal in days for received target certificate if it is differ from stored certificate
renewal_period_days = 0

[RDP-PROXY.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 5

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[RDP-PROXY.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[RDP-MITM]
[RDP-MITM.rdp_mitm]
# RDP extender toggle
# Enable to allow remote PrivX Extender client connections for tunneling RDP
# traffic inside VPC networks.
extender_enabled = true

# rdp-mitm public addresses
# If specified then these addresses are displayed in the PrivX UI as the rdp-mitm public addresses.
# Otherwise public addresses are automatically generated by combining shared.privx_public_fqdn_address
# and the rdp-mitm port ":3389". If you have a load balancer in front of the rdp-mitm which has an address
# different from shared.privx_public_fqdn_address, then specify the load balancer hostname/address and
# port here.
rdp_public_addresses = [
]

# Directory where temporary video files are generated before stored as part of
# trail
video_generator_temp_directory = "/tmp"

# How many workers encode video simultaneously. Encoding utilizes all cores, so
# this value should be fairly small.
video_generator_workers = 2

# Video encoding parameters to be passed for ffmpeg library. More info:
# https://trac.ffmpeg.org/wiki/Encode/H.264
# examples:
#   "profile=baseline preset=ultrafast flags=+qscale b=30000"
# for low bit rate video and fast encoding.
#   "preset=medium"
# for quite good video.
ffmpeg_parameters = "preset=medium"

# Should role context IP limitation checks be done with native SSH connections.
# Enabling IP restrictions for roles requires the real client IP is passed to PrivX services through possible network load balancers.
# Some load balancers do not support this, so IP checks would fail for those environments.
# If that's the case, but you still want to use IP limitations for web based access, set this value to false.
allow_role_ip_restrictions = true

# Reauthorization interval in seconds
reauthorization_interval_sec = 300

# Timeout interval (seconds) for connection message reply.
# Default: 5 seconds.
connection_message_timeout_sec = 5

[RDP-MITM.certificates]
# Replace the stored certificate if received target certificate is differ from stored certificate.
update_automatically = true

# Acceptable renewal period in months for received target certificate if it is differ from stored certificate
renewal_period_months = 1

# Acceptable renewal in days for received target certificate if it is differ from stored certificate
renewal_period_days = 0

[RDP-MITM.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 5

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[RDP-MITM.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[SSH-PROXY]
[SSH-PROXY.ssh_proxy]
# Reauthorization interval in seconds
reauthorization_interval_sec = 300

# SSH extender toggle
# Enable to allow remote PrivX Extender client connections for tunneling SSH traffic inside VPC networks.
extender_enabled = true

# SSH forwarder toggle
# Enable to allow forwarding of SSH connections from the PrivX agent
forwarder_enabled = false

# Web socket keepalive interval in seconds
ws_keepalive_interval_sec = 30

# Target ssh connection keepalive interval in seconds
ssh_keepalive_interval_sec = 30

# Interval for metadata updates to connection manager, in seconds.
metadata_update_interval_sec = 120

# Allow target connections to loopback addresses
allow_connect_to_loopback = false

# Allow target connections to local interface addresses
allow_connect_to_local_addresses = false

# Target blacklist: a comma separated list of IP addresses or subnets (CIDR) of prohibited SSH targets
target_blacklist = ""

# Timeout interval (seconds) for connection message reply.
# Default: 5 seconds.
connection_message_timeout_sec = 5

[SSH-PROXY.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 5

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[SSH-PROXY.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[SSH-MITM]
[SSH-MITM.ssh_mitm]

# Host key algorithms
# Supported algorithms: RSA, ECDSA, Ed25519
hostkey_algorithms = [
    "RSA",
    "Ed25519",
]

# ssh-mitm public addresses
# If specified then these addresses are displayed in the PrivX UI as the ssh-mitm public addresses.
# Otherwise public addresses are automatically generated by combining shared.privx_public_fqdn_address
# and the unique ports specified ssh_listen_addresses. If you have a load balancer in front of the
# ssh-mitm which has an address different from shared.privx_public_fqdn_address, then specify the load
# balancer hostname/address and port here.
ssh_public_addresses = [
]

# SSH extender toggle
# Enable to allow remote PrivX Extender client connections for tunneling SSH traffic inside VPC networks.
extender_enabled = true

# Extender websocket keepalive interval in seconds. Default 30.
ws_keepalive_interval_sec = 30

# Reauthorization interval in seconds
reauthorization_interval_sec = 300

# Interval for metadata updates to connection manager, in seconds.
metadata_update_interval_sec = 120

# Allow target connections to loopback addresses
allow_connect_to_loopback = false

# Allow target connections to local interface addresses
allow_connect_to_local_addresses = false

# Target blacklist: a comma separated list of IP addresses or subnets (CIDR) of prohibited SSH targets
target_blacklist = ""

# Should role context IP limitation checks be done with native SSH connections.
# Enabling IP restrictions for roles requires the real client IP is passed to PrivX services through possible network load balancers.
# Some load balancers do not support this, so IP checks would fail for those environments.
# If that's the case, but you still want to use IP limitations for web based access, set this value to false.
allow_role_ip_restrictions = true

# Exec connection idle timeout in seconds
exec_connection_idle_timeout_sec = 30

# Timeout interval (seconds) for connection message reply.
# Default: 5 seconds.
connection_message_timeout_sec = 5

[SSH-MITM.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 5

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[SSH-MITM.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[CONNECTION-MANAGER]
[CONNECTION-MANAGER.housekeeping]
# Interval for connection status housekeeping, in minutes.
# 0 means disabled.
housekeeping_interval = 5

# Retention period for connection metadata, in days.
# -1 means disabled.
housekeeping_conn_meta_retention = -1

# Interval for trail housekeeping, in hours.
# 0 means disabled.
housekeeping_interval_for_trails = 24

# Check trail integrity on trail housekeeping.
housekeeping_enable_integrity_checker = true

# Use sha256 checksum for trail integrity checker.
# If disabled, only trail size is verified (faster).
housekeeping_integrity_checker_use_checksum = true

[CONNECTION-MANAGER.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 20

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[CONNECTION-MANAGER.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################
[NETWORK-ACCESS-MANAGER]
[NETWORK-ACCESS-MANAGER.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 20

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[NETWORK-ACCESS-MANAGER.service]
# Reauthorization interval in seconds
reauthorization_interval_sec = 300

# Housekeeping interval in seconds
housekeeping_interval_sec = 60

# Maximum number of retries for PrivX router session removal
router_session_removal_max_retries = 5

# Timeout interval (seconds) for connection message reply.
# Default: 5 seconds.
connection_message_timeout_sec = 5

# Interval for metadata updates to connection manager, in seconds.
metadata_update_interval_sec = 120

# Timeout for network target sessions when no connection to connection manager (minutes).
timeout_when_no_connmgr_min = 5

# Extender connect timeout, in seconds.
extender_connect_timeout_sec = 10

[NETWORK-ACCESS-MANAGER.router]
# Routers
#
# type: linux-iptables
# {
#   "type": "linux-iptables",
#   "client_ip_pool": [ "10.0.0.0/24" ],
#   "username": "root",
#   "hostname": "router.privx.ssh.com",
# }
#
# type: sshexec
# {
#   "type": "sshexec",
#   "client_ip_pool": [ "11.0.0.0/24" ],
#   "username": "root",
#   "hostname": "router.privx.ssh.com",
#   "parameters": "router specific parameter string"
# }
#
# type: exec
# {
#   "type": "exec",
#   "client_ip_pool": [ "12.0.0.0/24" ],
#   "parameters": "router specific parameter string"
# }
routers = '[]'

[NETWORK-ACCESS-MANAGER.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################
[EXTENDER-SERVICE]

[EXTENDER-SERVICE.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 20

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[EXTENDER-SERVICE.service]

# Extender listener address resolution mode:
#   dynamic: select interface address using optional listener_addresses filter
#   static:  use static IP address from listener_addresses (first address that
#            matches the extender listener destination IP version)
listener_address_mode = "dynamic"

# Listener addresses for extender listener address resolution: An array of IP
# addresses or IP subnet CIDRs. Optional if listener_address_mode is dynamic,
# mandatory if listener_address_mode is static.
listener_addresses = [
]

# Port range for extender listener ports
listener_port_min = 11000
listener_port_max = 11999

# UDP port range for extender service listener ports
udp_listener_port_min = 12000
udp_listener_port_max = 12999

# Number of attempts of reconnecting to extender for UDP connections
udp_connection_reconnect_count = 2

# Web socket keepalive interval in seconds
ws_keepalive_interval_sec = 30

[EXTENDER-SERVICE.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################
[WORKFLOW-ENGINE]

[WORKFLOW-ENGINE.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[WORKFLOW-ENGINE.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""
##########################################################################################

[AUTH]
[AUTH.loginratelimit]
# Limit login attempts per username + remote IP pair
# Set to true/false to enable/disable.
enable_username_limit = true

# Maximum number of failed logins per user + IP, specified in number of logins.
# Login is disabled temporarily when remaining attempts are exhausted.
username_attempts_burst_size = 5

# The rate at which login attempts for users + IPs are regained,
# specified in number of attempts per minute.
username_attempts_per_minute = 1

# Limit login attempts per remote IP subnet.
# The remote IP is mapped to a /24 IPv4 subnet or /64 IPv6 subnet, and this
# subnet selects the rate limiting slot.
enable_subnet_limit = true

# Maximum number of failed logins per subnet, specified in number of logins.
# Login is disabled temporarily when remaining attempts are exhausted.
subnet_attempts_burst_size = 3000

# The rate at which login attempts for subnets are regained,
# specified in number of attempts per minute.
subnet_attempts_per_minute = 3000

# Whitelist of remote IP addresses excluded from IP-subnet-based login-
# rate limiting.
remoteip_white_list = "127.0.0.0/8,::1/128"

[AUTH.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 5

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[AUTH.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

[AUTH.loginmethods]
# Enable webauthn credential registration and webauthn login
webauthn_enabled = false

# Enable or disable Single Sign On
sso_enabled = false

##########################################################################################

[VAULT]
[VAULT.secrets]
# vault secrets schema definitions
# Credentials schema as default
schemas = '''
[
{
"name": "credentials",
"title": "Credentials",
"properties": [
{
"name": "user",
"title": "Username"
},
{
"name": "pass",
"title": "Password",
"masked": true
},
{
"name": "comment",
"title": "Comment",
"wide": true,
"multiline": true
}
]
}
]
'''

[VAULT.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[VAULT.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

##########################################################################################
[USER-STORE]
[USER-STORE.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[USER-STORE.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

##########################################################################################
[AUTHORIZER]
[AUTHORIZER.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2


[AUTHORIZER.certificate_templates]

# SSH certificate login templates
#
# Attributes:
# %H = target hostname
# %R = request client address
# %S = serial number
#
# Mappable user attributes:
# %P = PrivX username
# %I = principal
# %W = windows_account
# %U = unix_account
# %F = full_name
# %E = email
# %T = telephone
# %C = company
# %D = department
# %J = job_title
# %O = comment
#
# default = Cert auth template for regular SSH connections
# github = For GitHub Enterprise Cloud and GitLab Enterprise Server
# gitlab = For GitLab SaaS and on-prem

ssh_cert_templates='''
[{
    "name": "GitHub Enterprise",
    "description": "GitHub Enterprise",
    "key_id": "%W@%H",
    "principals": [],
    "extensions": [
        "login@%H=%W"
    ]
},
{
    "name": "GitLab",
    "description": "GitLab",
    "key_id": "%W",
	"principals": [
		"PrivXUsers"
	],
    "extensions": []
}]
'''

[AUTHORIZER.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

##########################################################################################

[LICENSE-MANAGER]
[LICENSE-MANAGER.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[LICENSE-MANAGER.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

##########################################################################################

[SECRETS-MANAGER]
[SECRETS-MANAGER.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[SECRETS-MANAGER.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

[SECRETS-MANAGER.winrm]
# Trust anchor certificates for WinRM host certificate validation. If WinRM host certificate
# is valid and signed by one of the trust anchors then the host certificate is
# silently accepted. Trust anchor certificates are configured as one or multiple
# concatenated PEM certificates.
winrm_host_certificate_trust_anchors = ""

##########################################################################################

[DB-PROXY]
[DB-PROXY.db]
# Maximum amount of time a connection may be reused (in seconds)
# 0 = connections are reused forever
# i.e. conn_max_lifetime = 900
conn_max_lifetime = 900

# SetConnMaxIdleTime sets the maximum amount of time a connection may be idle.
# If d <= 0, connections are not closed due to a connection's idle time.
conn_max_idletime = 900

# Maximum number of open connections to the database.
# If n <= 0, then there is no limit on the number of open connections.
max_open_conns = 10

# Maximum number of idle DB connections
# If n <= 0, no idle connections are retained
max_idle_conns = 2

[DB-PROXY.auditevents]
# skip_list sets the IDs of auditevents ignored from persisting to db.
# if skip_event_ids = "",  all the events persisted to DB.
# i.e. skip_event_ids = "10,44,100-200,250-290"
skip_event_ids = ""

[DB-PROXY.certificates]

# db proxy private key type: RSA or ECDSA
key_type = "ECDSA"

# RSA key size: 2048, 3072 or 4096. Not used if key_type is not RSA.
rsa_key_size = 2048

# ECDSA key size: 256, 384 or 521. Not used if key_type is not ECDSA.
ecdsa_key_size = 256

# Certificate cache size: Max 10000, specify as 0 to disable certificate caching.
cache_size = 1000

[DB-PROXY.dbproxy_internal]
# Reauthorization interval in seconds
reauthorization_interval_sec = 300

[DB-PROXY.host_trust_anchors]
# Trust anchor certificates for DB host certificate validation. If DB host certificate
# is valid and signed by one of the trust anchors then the host certificate is
# silently accepted. Trust anchor certificates are configured as one or multiple
# concatenated PEM certificates.
host_certificate_trust_anchors = ""

##########################################################################################
